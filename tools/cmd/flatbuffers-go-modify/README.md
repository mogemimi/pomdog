# flatbuffers-go-modify

A command-line tool for modifying Go code generated by FlatBuffers compiler (flatc).

## Features

- **Enable shared strings** (`-sharedstring`): Replace `CreateString()` calls with `CreateSharedString()` to reduce FlatBuffers binary size by sharing duplicate strings

## Background

When using FlatBuffers, the compiler (`flatc`) generates Go code that uses `builder.CreateString()` for string fields. However, FlatBuffers supports a shared string feature that allows identical strings to be stored only once in the binary, reducing the overall size.

This tool modifies the generated Go code to use `CreateSharedString()` instead of `CreateString()`, enabling this optimization.

## Installation

```sh
cd tools/cmd/flatbuffers-go-modify
go build
```

## Usage

```sh
flatbuffers-go-modify -i <input file> -o <output file> [options]
```

### Options

| Option | Description |
|--------|-------------|
| `-i <path>` | Input file (FlatBuffers-generated Go code) |
| `-o <path>` | Output file path |
| `-sharedstring` | Enable shared string optimization |

### Examples

Enable shared strings in generated Go code:

```sh
flatbuffers-go-modify -i generated/schema_generated.go -o generated/schema_generated.go -sharedstring
```

Typical workflow with flatc:

```sh
# 1. Generate Go code from FlatBuffers schema
flatc --go -o generated/ schema.fbs

# 2. Modify the generated code to use shared strings
flatbuffers-go-modify -i generated/schema_generated.go -o generated/schema_generated.go -sharedstring
```

## Notes

- This tool replaces `builder.CreateString(` with `builder.CreateSharedString(` in the generated code
- Shared strings reduce binary size when the same string value appears multiple times
- Run this tool after each `flatc` code generation
